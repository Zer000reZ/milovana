(this["webpackJsonpeos-host"]=this["webpackJsonpeos-host"]||[]).push([[6],{203:function(t,e,n){"use strict";n.r(e);var a=n(1),r=n.n(a),s=n(2),o=n(3),i=n(53),u=n(15),l=n.n(u),p=l()("eos:pcm2:Pcm2PageTracker"),h=function(){function t(e){Object(s.a)(this,t),this.host=e(i.a),this.runCounter=0,this.pageFirstRun=new Map,this.pageLastRun=new Map,this.setPages=new Map,this.mustRelations=new Map,this.mustNotRelations=new Map,this.numActionsRelations=new Map,this.numActionsFromRelations=new Map,this.repeat=new Map,this.simpleRepeatGoal=new Map,this.simpleRepeatState=new Map,this.currentPage=null,this.host.on("page",this.handlePage.bind(this))}return Object(o.a)(t,[{key:"set",value:function(t){p("set page %s",t);var e=this.setPages.get(t)||0;this.setPages.set(t,e+1)}},{key:"unset",value:function(t){p("unset page %s",t),this.setPages.delete(t)}},{key:"isSet",value:function(t){var e=this.setPages.get(t)||0,n=this.repeat.get(t);return"undefined"===typeof n&&(n=1),e>=n}},{key:"isValidTarget",value:function(t){if(this.isSet(t))return p("not a valid target, page already set. page=%s",t),!1;var e=!0,n=!1,a=void 0;try{for(var r,s=(this.mustRelations.get(t)||[])[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;if(!this.isSet(o))return p("not a valid target, other page must be set. page=%s other=%s",t,o),!1}}catch(F){n=!0,a=F}finally{try{e||null==s.return||s.return()}finally{if(n)throw a}}var i=!0,u=!1,l=void 0;try{for(var h,c=(this.mustNotRelations.get(t)||[])[Symbol.iterator]();!(i=(h=c.next()).done);i=!0){var d=h.value;if(this.isSet(d))return p("not a valid target, other page must not be set. page=%s other=%s",t,d),!1}}catch(F){u=!0,l=F}finally{try{i||null==c.return||c.return()}finally{if(u)throw l}}var f=!0,m=!1,v=void 0;try{for(var g,y=(this.numActionsRelations.get(t)||[])[Symbol.iterator]();!(f=(g=y.next()).done);f=!0){var R=g.value;if(this.runCounter<R)return p("not a valid target, must have run number of actions. page=%s num=%s actual=%s",t,R,this.runCounter),!1}}catch(F){m=!0,v=F}finally{try{f||null==y.return||y.return()}finally{if(m)throw v}}var b=!0,w=!1,N=void 0;try{for(var P,M=(this.numActionsFromRelations.get(t)||[])[Symbol.iterator]();!(b=(P=M.next()).done);b=!0){var S=P.value,C=S.num,A=S.since,k=this.pageFirstRun.get(A);if("undefined"===typeof k)return p("not a valid target, other page must have run number of steps before but has not run at all. page=%s other=%s num=%s",t,A,C),!1;var x=this.runCounter-k;if(x<C)return p("not a valid target, other page must have run number of steps before. page=%s other=%s num=%s actual=%s",t,A,C,x),!1}}catch(F){w=!0,N=F}finally{try{b||null==M.return||M.return()}finally{if(w)throw N}}return p("valid target. page=%s",t),!0}},{key:"handlePage",value:function(t){this.currentPage=t,this.runCounter++,this.set(t),this.pageFirstRun.has(t)||this.pageFirstRun.set(t,this.runCounter),this.pageLastRun.set(t,this.runCounter)}},{key:"addMustRelation",value:function(t,e){p("add must relation. page=%s other=%s",t,e),this.mustRelations.has(t)||this.mustRelations.set(t,new Set),this.mustRelations.get(t).add(e)}},{key:"addMustNotRelation",value:function(t,e){this.mustNotRelations.has(t)||this.mustNotRelations.set(t,new Set),this.mustNotRelations.get(t).add(e)}},{key:"addNumActionsRelation",value:function(t,e){this.numActionsRelations.has(t)||this.numActionsRelations.set(t,[]),this.numActionsRelations.get(t).push(e)}},{key:"addNumActionsFromRelation",value:function(t,e,n){this.numActionsFromRelations.has(t)||this.numActionsFromRelations.set(t,[]),this.numActionsFromRelations.get(t).push({num:n,since:e})}},{key:"setRepeat",value:function(t,e){p("repeatset page %s => %s",t,e),this.repeat.set(t,e)}},{key:"addRepeat",value:function(t,e){var n=this.repeat.get(t);"undefined"===typeof n&&(n=1),p("repeatadd page %s +%s => %s",t,e,n+=e),this.repeat.set(t,n)}},{key:"delRepeat",value:function(t,e){var n=this.repeat.get(t);"undefined"===typeof n&&(n=1),p("repeatdel page %s -%s => %s",t,e,n-=e),this.repeat.set(t,n)}},{key:"maybeRepeat",value:function(t){var e=t.count,n=t.max,a=t.target,r=this.simpleRepeatGoal.get(this.currentPage);"undefined"===typeof r&&(r="undefined"===typeof n?e:Math.floor(Math.random()*(n-e))+e,this.simpleRepeatGoal.set(this.currentPage,r));var s=this.simpleRepeatState.get(this.currentPage);return"undefined"===typeof s&&(s=0),p("repeat %s/%s",s,r),s<r?(s++,this.simpleRepeatState.set(this.currentPage,s),this.currentPage):(this.simpleRepeatGoal.delete(this.currentPage),this.simpleRepeatState.delete(this.currentPage),a)}}]),t}(),c=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.self,a=n.pages,r=e(h),s=!0,o=!1,i=void 0;try{for(var u,l=a[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var p=u.value;r.addMustRelation(t,p)}}catch(c){o=!0,i=c}finally{try{s||null==l.return||l.return()}finally{if(o)throw i}}}}},d=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.self,a=n.pages,r=e(h),s=!0,o=!1,i=void 0;try{for(var u,l=a[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var p=u.value;r.addMustNotRelation(t,p)}}catch(c){o=!0,i=c}finally{try{s||null==l.return||l.return()}finally{if(o)throw i}}}}},f=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.self,a=n.count;e(h).addNumActionsRelation(t,a)}}},m=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.self,a=n.action,r=n.count;e(h).addNumActionsFromRelation(t,a,r)}}},v=l()("eos:pcm2:command:range"),g=function(t){var e=t.deps,n=t.host,a=t.opts;return{run:function(){var t=a.from,r=a.to,s=a.prefix,o=void 0===s?"":s,i=e(h);v("finding target in range. prefix=%s from=%s to=%s",o,t,r);for(var u=[],l=Number(t);l<=Number(r);l++){var p=o+String(l);n.getPage(p)&&i.isValidTarget(p)&&u.push(p)}u.length&&n.showPage(u[Math.floor(Math.random()*u.length)])}}},y=l()("eos:pcm2:command:repeat"),R=function(t){var e=t.deps,n=t.host,a=t.opts;return{run:function(){var t=a.count,r=a.target,s=a.max,o=e(h);y("repeating page. count=%s max=%s target=%s",t,s,r),n.showPage(o.maybeRepeat({count:t,max:s,target:r}))}}},b=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.target,a=n.count;e(h).setRepeat(t,Number(a))}}},w=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.target,a=n.count;e(h).addRepeat(t,Number(a))}}},N=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.target,a=n.count;e(h).delRepeat(t,Number(a))}}},P=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.pages,a=e(h),r=!0,s=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var l=i.value;a.set(l)}}catch(p){s=!0,o=p}finally{try{r||null==u.return||u.return()}finally{if(s)throw o}}}}},M=function(t){var e=t.deps,n=t.opts;return{run:function(){var t=n.pages,a=e(h),r=!0,s=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var l=i.value;a.unset(l)}}catch(p){s=!0,o=p}finally{try{r||null==u.return||u.return()}finally{if(s)throw o}}}}},S=n(5);e.default=function(t){var e,n,a;return r.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=t(h),n=function(t,n){var a=t.createObject(t.OBJECT);t.setProperty(n,"pages",a);for(var r=function(){var n=o[s];t.setProperty(a,n,t.createNativeFunction((function(){for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return r=r.map((function(e){return t.pseudoToNative(e)})),e[n].apply(e,r)})),S.a.NONENUMERABLE_DESCRIPTOR)},s=0,o=["isSet","isValidTarget","addMustRelation","addMustNotRelation","addNumActionsRelation","addNumActionsFromRelation","setRepeat","addRepeat","delRepeat"];s<o.length;s++)r()},a={mustCommand:c,mustnotCommand:d,numactionsCommand:f,numactionsfromCommand:m,rangeCommand:g,repeatCommand:R,repeatsetCommand:b,repeataddCommand:w,repeatdelCommand:N,setCommand:P,unsetCommand:M},r.abrupt("return",{vm:n,commands:a});case 4:case"end":return r.stop()}}))}}}]);
//# sourceMappingURL=6.bc35bcdf.chunk.js.map